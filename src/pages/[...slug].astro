---
import contentful from '@lib/contentful';
import type { TypePageSkeleton } from '@lib/generated/contentful/index';
import type { Entry } from '@lib/types';
import { prependSlash } from '@lib/utils';
import Extraordinario from 'src/layouts/Extraordinario.astro';
import Festinalente from 'src/layouts/Festinalente.astro';
import Generic from 'src/layouts/Generic.astro';
import Homepage from 'src/layouts/Homepage.astro';
import Partnership from 'src/layouts/Partnership.astro';
import Showcase from 'src/layouts/Showcase.astro';
import Ubuntu from 'src/layouts/Ubuntu.astro';

export async function getStaticPaths() {
	const pages = await contentful.getEntries<TypePageSkeleton>({
		content_type: 'page',
		include: 10, // max include depth
	});

	return pages.items.map((page) => {
		const slug = prependSlash(page.fields.slug);
		return {
			params: { slug: slug === '/' ? undefined : slug },
			props: {
				page,
			},
		};
	});
}

const getLayout = (page: Entry<TypePageSkeleton>) => {
	switch (page.fields.layout) {
		case 'Generico':
			return Generic;
		case 'Homepage':
			return Homepage;
		case 'Evento 2023':
			return Extraordinario;
		case 'Showcase':
			return Showcase;
		case 'Partnership':
			return Partnership;
		case 'Evento 2022':
			return Ubuntu;
		case 'Evento 2021':
			return Festinalente;
		default:
			return Generic;
	}
};

const { page } = Astro.props;
const Layout = getLayout(page);
---

<Layout {...page} />
